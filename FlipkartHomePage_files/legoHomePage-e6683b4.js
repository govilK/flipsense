if(typeof(FKART)=="undefined"){FKART={}}FKART.AppOffer=new function(){var a=[],b=[];this.clearList=function(){a=[];b=[];fk_appoffer.updateTopBanner()};this.addAppOnly=function(c){if(a.indexOf(c)==-1){a.push(c);fk_appoffer.updateTopBanner()}};this.addOpenFsn=function(c){if(b.indexOf(c)==-1){b.push(c);fk_appoffer.updateTopBanner()}};this.updateTopBanner=function(){var e=$("#fk-header"),f=$(".fk-header-banner"),d=$(".apponly-text-some",f),g=$(".apponly-text-all",f),c=$(".apponly-text-default",f);if(a.length===0&&c.length===0){e.removeClass("banner-open");f.slideUp("slow")}else{if(!e.hasClass("banner-open")){e.addClass("banner-open");f.slideDown("slow")}if(a.length===0){d.hide();g.hide();c.show()}else{if(b.length===0){d.hide();g.show();c.hide()}else{d.show();g.hide();c.hide()}}}};this.updateUrl=function(){$(".fk-header-banner .app-link, .product-openx-ad .app-link, .facetList .app-link, .offers-info .app-link, .app-exchange-box .app-link, .shop-section .app-link").data("url",window.location.pathname+window.location.search);$(".fk-header-banner .app-link, .product-openx-ad .app-link, .facetList .app-link").data("title","Get extra offers only on app");$(".fk-header-banner .app-link, .product-openx-ad .app-link, .facetList .app-link").data("subtitle","Tap to view special offer only on the app");var c=$(".fk-header-banner .app-link");if((c.length===0||!c.data("query")||c.data("query").length===0)&&FKART.urlParser().get("sid")=="undefined"){c.hide()}else{c.show()}}};fk_appoffer=FKART.AppOffer;FKART.appOfferPopup=function(aQ){var ad=$(aQ),z=$(".app-link",ad),V=$(".app-offers-button",ad),aw=$(".app-offers-container",ad),aD=$(".appOnlyDialog-popup-content",ad),af=$(".fk-question-mark",ad),B,aO,aM,be,aj,Q,J,bg,aN,K,e,t,v,E,av,S,a4,aC,a3,R,P,M,ae,r,b,am,x,bc,d,G=false,aq,p,ax,a6=false,a2,aS,aH,bb,j,aE,ag,l,ao,aa,aW,m,a,f,ab,a8=false,ba,g,aZ,an,C,H,I,L,ar,o,aV,a5,X,ap,ai,aY,Z,q,aP,bd,O="",au="",U=false,az=false,N,aG,aU,a0,h;if(aD.length==0){aD=$("#fk-header .appOnlyDialog-popup-content")}if(aD.length==0){aD=$(".fk-mainfooter .appOnlyDialog-popup-content")}if(aD.length==0){aD=$(".appOnlyDialog-popup-content.forcedView")}function c(){V.on("click",function(){if(!U){a9("Opened");$(this).addClass("open");af.text("X");setTimeout(function(){aw.slideDown(200);U=true},150)}else{a9("Closed");aw.slideUp(200,function(){V.removeClass("open");af.text("?");U=false})}});z.on("click",function(bh){if(!z.hasClass("disabled")){w($(this));a9("Clicked");bf();bh.preventDefault()}})}function bf(){x=null;n();T();a1();u();ac();if(!FKART.login.isUserLoggedIn()){S.hide();aR()}else{if(a6==true){S.show();B.hide();Z=setTimeout(function(){G=true;$.ajax({url:"/lc/sendPushNotificationForAccount",data:{pid:ba,lid:g,sid:aZ,query:an,offerid:ab,cmpid:o,semcmpid:aV,title:C,subtitle:H,vertical:I,url:L,useDataUrl:a8},type:"POST",dataType:"json",success:function(bh){if(bh.deviceFound&&bh.notificationSent){aT()}else{aK()}},error:function(){aK()}})},7000)}else{aR();ay()}}}function ay(){$.ajax({url:"/lc/sendPushNotificationForAccount",data:{pid:ba,lid:g,sid:aZ,query:an,offerid:ab,cmpid:o,semcmpid:aV,title:C,subtitle:H,vertical:I,url:L,useDataUrl:a8},type:"POST",dataType:"json",success:function(bh){if(bh.deviceFound&&bh.notificationSent){Q.show()}else{J.show()}},error:function(){J.show()}})}function a9(bi){var bh={};if(bi=="Clicked"){bh.products=s.products}var bj=new Array("eVar1","eVar2","eVar3","eVar4","eVar5","eVar11","eVar50","eVar55","eVar68","prop1","prop2","prop3","prop4","prop20","prop35");for(i in bj){if(typeof s[bj[i]]!="undefined"){bh[bj[i]]=s[bj[i]]}if((bj[i]=="eVar55"||bj[i]=="eVar11")&&ar){bh[bj[i]]=ar}if((bj[i]=="eVar68"||bj[i]=="prop20")&&a5){bh[bj[i]]=a5}}bh.prop21="OpenInApp_"+bi;FKART.omni.customEvent("App only offers",bh)}function aT(){u();S.hide();if(X&&X.length>0){var bh=$("<img>");bh.attr("src",X);bg.append(bh)}else{bg.remove()}aO.show();aI();a9("PNSent")}function aK(){u();S.hide();aN.show();a9("PNFailed")}function ac(){x=new FKART.ui.Dialog({showFooter:false,cssClass:"appOnlyDialog",body:aD.html(),destroyOnHide:true,width:"620px"});d=x.getContainer();S=d.find(".loadingDiv");B=d.find(".smsDiv");aO=d.find(".successDiv");aM=B.find(".stitle");aj=B.find(".footerLoggedIn");Q=aj.find(".footerLoggedIn_autonotification_success");J=aj.find(".footerLoggedIn_autonotification_failure");be=B.find(".footerNotLoggedIn");bg=aO.find(".phone-image span");a2=d.find(".smsForm");bc=d.find(".successPrefixDiv");aN=d.find(".errorDiv");a4=d.find(".send-sms-fake-link");aC=d.find(".send-otp-fake-link");a3=d.find(".send-sms-link");R=d.find(".send-otp-link");ae=d.find(".resend-sms-fake-link");r=d.find(".resend-otp-fake-link");b=d.find(".resend-sms-link");am=d.find(".resend-otp-link");q=d.find(".timer");aP=d.find(".timerResendSMS");bd=d.find(".timerResendOTPSMS");aq=d.find(".retry-notification");N=d.find(".otpForm");h=d.find(".js-doLogin");aU=d.find(".phoneNumber");a0=d.find(".otp-field");x.show();if(!FKART.login.isUserLoggedIn()){be.show();aj.hide()}else{be.hide();aj.show()}aL()}function aL(){d.on("beforeHide",function(bh){n();T();a1();u()});h.on("click",function(){x.hide()});a3.on("click",function(){aO.hide();bc.show();aN.hide();aM.remove();if(!FKART.login.isUserLoggedIn()){be.show();aj.hide()}else{be.hide();aj.show();Q.show()}aR();a9("PNExpired")});R.on("click",function(){al();aO.hide();bc.show();aN.hide();aM.remove();aR();a9("PNExpired")});aq.on("click",function(){x.hide();a6=true;bf();$status="PNTried";if(G){$status="PNReTried"}a9($status)});aU.on("keypress",function(bi){bi=bi||window.event;var bh=bi.keyCode||bi.which;if(bh==13){aH.trigger("click");bi.preventDefault()}});a0.on("keypress",function(bi){bi=bi||window.event;var bh=bi.keyCode||bi.which;if(bh==13){aS.trigger("click");bi.preventDefault()}})}function A(bh){return bh}function at(){m=f.val();ao=l.val();a=bb.val();M=P.val();$.ajax({url:"/lc/verifyOtp",type:"POST",data:{user_id:ao,otp_key:O,otp:m,pid:ba,lid:g,sid:aZ,query:an,offerid:ab,title:C,subtitle:H,vertical:I,url:L,phoneNumber:ao,useDataUrl:a8,marketingSMS:a,AppOffers:M},dataType:"html",success:function(bh){bh=JSON.parse(bh);if(bh.verifyOTPstatus=="false"){ah()}else{if(bh.verifyOTPstatus=="true"&&bh.isOtpVerified=="1"){if(bh.smsStatus){aX()}else{aJ()}}else{ah()}}},error:function(){ah()}})}function al(){ao=l.val();$.ajax({url:"/lc/generateOtp",type:"POST",data:{userId:ao},dataType:"html",success:function(bh){bh=JSON.parse(bh);if(bh.generateOTPstatus=="false"){ah()}else{if(bh.error_code=="1004"){D()}else{if(bh.generateOTPstatus=="true"){O=bh.otp_key;aA()}else{ah()}}}},error:function(){ah()}})}function Y(){ao=l.val();$.ajax({url:"/lc/getVerifiedPhoneNumber",type:"POST",data:{phoneNumber:ao,pid:ba,lid:g,sid:aZ,query:an,offerid:ab,title:C,subtitle:H,vertical:I,url:L,phoneNumber:ao,useDataUrl:a8,marketingSMS:a,AppOffers:M},dataType:"html",success:function(bh){bh=JSON.parse(bh);if(bh.errorMsg){F()}else{if(bh.verifiedPhoneNumber){if(bh.smsStatus){aX()}else{aJ()}}else{al()}}},error:function(){F()}})}function aX(){T();a1();aM.hide();j.hide();aE.hide();a2.hide();N.hide();ag.html(ao);K.show();e.hide();ae.show();b.hide();k();a9("SMSSent")}function aJ(){T();a1();e.hide();aM.hide();j.hide();aE.hide();a2.hide();aN.hide();ag.html(ao);av.show();a9("SMSFailed")}function ah(){a1();T();aM.hide();j.hide();aE.hide();a2.hide();aN.hide();ag.html(ao);e.hide();t.show();a9("OTPFailed")}function F(){T();a1();aM.hide();j.hide();aE.hide();a2.hide();aN.hide();e.hide();t.hide();E.show();a9("SMSFailed")}function aA(){a1();T();aM.hide();j.hide();aE.show();N.show();a2.hide();ag.html(ao);e.show();r.show();am.hide();ak();a9("OTPSent")}function D(){v.show();aM.hide();j.hide();aE.hide();N.hide();a2.hide();ag.html(ao);e.hide();r.hide();am.hide();a9("OTPFailed")}function aR(){l=a2.find(".phoneNumber");f=N.find(".otp-field");ao=FKART.login.userPhoneNumber;l.val(ao);aH=a2.find("input[type=button]");aS=N.find("input[type=button]");bb=B.find("#marketingSMS");P=B.find("#AppDownload");j=B.find(".infoDiv");aE=B.find(".otpTitle");aM=B.find(".stitle");K=B.find(".smsSuccessDiv");e=B.find(".otpSuccessDiv");t=B.find(".otpErrorDiv");v=B.find(".otpErrorMsgDiv");E=B.find(".otpSendErrorDiv");av=B.find(".smsErrorDiv");p=B.find(".retry-sms");ax=B.find(".retry-otp");ag=B.find(".phone_number");B.show();N.hide();aE.hide();x.reposition();W()}function W(){aH.on("click",function(bh){ao=l.val();if(!(/^[789]\d{9}$/.test(ao))){l.addClass("error").val("").attr("placeholder","Invalid Number").focus();return}Y();bh.preventDefault()});aS.on("click",function(bh){m=f.val();if(!(/^[0-9]{4,6}$/.test(m))){f.addClass("error").val("").attr("placeholder","Invalid OTP").focus();return}else{at();aM.hide();K.hide();j.hide();av.hide();e.hide();aE.hide();N.hide();a9("SMSTried");bh.preventDefault()}});p.on("click",function(){T();a1();aP.html("45");bd.html("60");aM.hide();K.hide();j.hide();a2.hide();av.hide();Y();a9("SMSReTried")});ax.on("click",function(){a1();T();al();aP.html("45");bd.html("60");aE.show();K.hide();N.show();av.hide();a9("SMSReTried")})}function n(){clearInterval(ap);ap=null}function T(){clearInterval(ai);ai=null}function a1(){clearInterval(aY);aY=null}function u(){clearInterval(Z);Z=null}function aI(){ap=setInterval(function(){var bh=parseInt(q.html());if(bh==0){n();a4.hide();a3.show()}q.html(bh-1)},1000)}function k(){ai=setInterval(function(){var bh=parseInt(aP.html());if(bh==0){T();a1();ae.hide();b.show()}aP.html(bh-1)},1000)}function ak(){aY=setInterval(function(){var bh=parseInt(bd.html());if(bh==0){a1();T();r.hide();am.show()}bd.html(bh-1)},1000)}function y(bi,bh){if(bi.indexOf("?")!==-1){var bl=bi.split("?")[1];var bk=bl.split("&");for(var bj=0;bj<bk.length;bj++){var bm=bk[bj].split("=");if(bm[0]==bh){return bm[1]}}}}function a7(){var bh=FKART.urlParser().get("sid");if(bh!="undefined"){return bh}}function w(bj){X=bj.data("image");if(bj.data("pid")){ba=bj.data("pid").toString();I=bj.data("vertical");if(bj.data("lid")){g=bj.data("lid").toString()}ab=bj.data("offerid");if(bj.data("url")){o=y(bj.data("url"),"cmpid");aV=y(bj.data("url"),"semcmpid")}}else{an=bj.data("query");aZ=a7();if(aZ){I=("BROWSE_"+aZ).toUpperCase()}else{if(bj.data("vertical")){I=bj.data("vertical")}else{I="BROWSE_SEARCH"}}if(bj.data("url")){ba=y(bj.data("url"),"pid");aZ=y(bj.data("url"),"sid");ab=y(bj.data("url"),"offer");o=y(bj.data("url"),"cmpid");aV=y(bj.data("url"),"semcmpid");if(y(bj.data("url"),"p[]")||bj.data("url").indexOf("/~")){a8=true}}C=bj.data("title");H=bj.data("subtitle");L=bj.data("url");if(bj.attr("href")){ar=y(bj.attr("href"),"icmpid");a5=y(bj.attr("href"),"otracker")}}if((o==""||typeof(o)=="undefined")&&(aV==""||typeof(aV)=="undefined")){var bh=aB("TGSRC");if(bh){var bi=bh.split(":");if(bi[0]=="cmpid"&&bi.length=="2"){o=bi[1]}if(bi[0]=="semcmpid"&&bi.length=="2"){aV=bi[1]}}}a6=false;G=false}function aF(){c()}function aB(bi){var bk=bi+"=";var bh=document.cookie.split(";");for(var bj=0;bj<bh.length;bj++){var bl=bh[bj];while(bl.charAt(0)==" "){bl=bl.substring(1,bl.length)}if(bl.indexOf(bk)==0){return bl.substring(bk.length,bl.length)}}return null}aF()};register_controller("AppOffersCtrl",function(a){FKART.appOfferPopup(a)});FKART.showShutDownPopup=function(c){var b=(new Date()).getTime(),e=FKART.utils.localStorage.getObject("sdPopDetails")||{};function d(g){var f=new FKART.ui.Dialog({header:"Flipkart System Message",showFooter:false,body:c,cssClass:"desk-shut"});FKART.utils.localStorage.setObject("sdPopDetails",{timeStamp:g});f.show()}if(!jQuery.isEmptyObject(e)){var a=e.timeStamp+(24*60*60*1000);if(a<b){d(b)}}else{d(b)}};register_controller("ShutDownPopCtrl",function(a){FKART.showShutDownPopup(a)});FKART.appDownloadPopup=function(P){var u=$(P),r=$(".app-download",u),G,V,A,W,w,L,ac,ae,b,B,j,F,I,k,U,z,K,y,J,l,M,E=false,n="title",Y="subtitle",ad,X,v,a,N,D,m,d=false;function q(){r.click(function(af){if(!r.hasClass("disabled")){g("Clicked");R($(this));t();af.preventDefault()}})}function t(){ae=null;Z();f()}function g(ag){var af={};if(ag=="Clicked"){af.products=s.products}af.prop21="OpenInApp_"+ag;FKART.omni.customEvent("App only offers",af)}function H(){h();if(ad&&ad.length>0){var af=$("<img>");af.attr("src",ad);V.append(af)}else{V.remove()}C();g("PNSent")}function Q(){h();f();g("PNFailed")}function Z(){ae=new FKART.ui.Dialog({showFooter:false,cssClass:"appDownloadDialog",body:$(".appDownloadDialog-popup-content").html(),destroyOnHide:true,width:"620px"});b=ae.getContainer();w=b.find(".headerDiv");G=b.find(".smsDiv");F=b.find(".smsForm");L=b.find(".send-sms-fake-link");ac=b.find(".send-sms-link");m=b.find(".timer");B=b.find(".retry-notification");ae.show();e()}function e(){b.on("beforeHide",function(af){ab();h();E=false});ac.click(function(){f();g("PNExpired")});B.click(function(){ae.hide();t();g("PNReTried")})}function T(){l=J.val();if(!(/^[789]\d{9}$/.test(l))){J.addClass("error").val("").attr("placeholder","Invalid Number").focus();return}else{$.ajax({url:"/lc/sendAppDownloadSMS",type:"POST",data:{title:n,subtitle:Y,phoneNumber:l,captchaText:z.val(),captchaId:K.attr("id")},dataType:"json",success:function(af){if(af.captchaStatus){if(af.smsStatus){S()}else{x()}}else{p()}},error:function(){x()}})}}function p(){o();z.addClass("error").val("").attr("placeholder","Invalid Captcha").focus()}function S(){k.hide();F.hide();y.html(l);A.show();g("SMSSent")}function x(){k.hide();F.hide();y.html(l);W.show();g("SMSFailed")}function f(){J=F.find(".phoneNumber");l=FKART.login.userPhoneNumber;J.val(l);I=F.find("input[type=submit]");k=G.find(".infoDiv");A=G.find(".smsSuccessDiv");W=G.find(".smsErrorDiv");j=G.find(".retry-sms");U=F.find(".captchaDiv");z=F.find(".captchaText");M=F.find(".refreshCaptcha");y=G.find(".phone_number");if(/^\d{10}$/.test(l)){E=true;o()}G.show();ae.reposition();O()}function O(){M.click(function(){o();z.val("").focus()});F.submit(function(af){T();g("SMSTried");af.preventDefault()});j.click(function(){k.show();F.show();A.hide();W.hide();z.removeClass("error").val("").attr("placeholder","Captcha text").focus();o();g("SMSReTried")});J.focus(function(){g("PhoneNumberFocused");if(!E){E=true;o()}})}function o(){$.ajax({url:"/lc/generateCaptcha",type:"POST",dataType:"json",success:function(af){if(af.success){K=U.find("img");K.attr("src","data:image/png;base64,"+af.captchaBytes);K.attr("id",af.id);U.show();z.show();K.load(function(){if(this.complete){ae.reposition()}})}else{U.find("img").attr("alt","Captcha failed to load")}},error:function(){U.find("img").attr("alt","Captcha failed to load")}})}function ab(){clearInterval(N);N=null}function h(){clearInterval(D);D=null}function C(){N=setInterval(function(){var af=parseInt(m.html());if(af==0){ab();L.hide();ac.show()}m.html(af-1)},1000)}function c(ag,af){var aj=ag.split("?")[1];var ai=aj.split("&");for(var ah=0;ah<ai.length;ah++){var ak=ai[ah].split("=");if(ak[0]==af){return ak[1]}}}function R(){$ele=window.location.href}function aa(){q()}aa()};register_controller("AppDownloadCtrl",function(a){FKART.appDownloadPopup(a)});register_controller("AppDownloadInterstitialCtrl",function(aK){var Z=$(aK),z=$(".app-link-interstitial",Z),S=$(".app-offers-button",Z),aq=$(".app-offers-container",Z),ax=$(".appDownloadInterstitial-popup-content",Z),ab=$(".fk-question-mark",Z),B,aI,aG,a5,af,a7,aH,I,f,r,u,D,ap,P,aX,aw,aW,O,N,K,aa,p,c,ai,w,a3,e,G=false,am,o,ar,aY=false,aV,aM,aB,aR,j,ay,ac,l,ak,V,m,g,b,X,a0=false,a2,h,aS,aj,aT="title",y="subtitle",H,J,al,ae,aP,W,q,aJ,a4,R=false,M="",ao="",R=false,au=false,L,aA;if(ax.length==0){ax=$(".fk-mainfooter .appOnlyDialog-popup-content")}if(ax.length==0){ax=$(".appOnlyDialog-popup-content.forcedView")}function d(){S.on("click",function(){if(!R){a1("Opened");$(this).addClass("open");ab.text("X");setTimeout(function(){aq.slideDown(200);R=true},150)}else{a1("Closed");aq.slideUp(200,function(){S.removeClass("open");ab.text("?");R=false})}});z.on("click",function(a8){if(!z.hasClass("disabled")){a1("Clicked");v($(this));a6();a8.preventDefault()}});EventBus.subscribe("appDownloadInterstitialpopup",function(){v($(this));a6();FKART.utils.localStorage.setObject("sAppDownloadInterstitial",{sPopup:false})});EventBus.subscribe("Win10appDownloadInterstitialpopup",function(){if(a()){v($(this));a6()}})}function aQ(a9,bc,ba){var bb=new Date();bb.setTime(bb.getTime()+(ba*24*60*60*1000));var a8="expires="+bb.toGMTString();document.cookie=a9+"="+bc+"; "+a8}function E(ba){var a9=ba+"=";var a8=document.cookie.split(";");for(var bb=0;bb<a8.length;bb++){var bc=a8[bb];while(bc.charAt(0)==" "){bc=bc.substring(1)}if(bc.indexOf(a9)==0){return bc.substring(a9.length,bc.length)}}return""}function a(){var a8=E("win10IntPopup");if(a8!=""){return false}else{a8="true";if(a8!=""&&a8!=null){aQ("win10IntPopup",a8,1)}return true}}function a6(){w=null;Y();aL()}function at(){$.ajax({url:"/lc/sendPushNotificationForAccount",data:{pid:a2,lid:h,sid:aS,query:aj,offerid:X,title:title,subtitle:subtitle,vertical:H,url:J,useDataUrl:a0},type:"POST",dataType:"json"})}function a1(a9){var a8={};if(a9=="Clicked"){a8.products=s.products}var ba=new Array("eVar1","eVar2","eVar3","eVar4","eVar5","eVar50","prop1","prop2","prop3","prop4","prop35");for(i in ba){if(typeof s[ba[i]]!="undefined"){a8[ba[i]]=s[ba[i]]}}a8.prop21="OpenInApp_"+a9;FKART.omni.customEvent("App only offers",a8)}function aN(){t();P.hide();if(imageSrc&&imageSrc.length>0){var a8=$("<img>");a8.attr("src",imageSrc);a7.append(a8)}else{a7.remove()}aI.show();aC();a1("PNSent")}function aE(){t();P.hide();aH.show();a1("PNFailed")}function Y(){w=new FKART.ui.Dialog({showFooter:false,cssClass:"appDownloadInterstitialDialog",body:ax.html(),destroyOnHide:true,width:"730px"});e=w.getContainer();P=e.find(".loadingDiv");B=e.find(".smsDiv");aI=e.find(".successDiv");aG=B.find(".stitle");af=B.find(".footerLoggedIn");a5=B.find(".footerNotLoggedIn");a7=aI.find(".phone-image span");aV=e.find(".smsForm");a3=e.find(".successPrefixDiv");aH=e.find(".errorDiv");aX=e.find(".send-sms-fake-link");aW=e.find(".send-sms-link");O=e.find(".send-otp-link");aa=e.find(".resend-sms-fake-link");p=e.find(".resend-otp-fake-link");c=e.find(".resend-sms-link");ai=e.find(".resend-otp-link");q=e.find(".timer");aJ=e.find(".timerResendSMS");a4=e.find(".timerResendOTPSMS");am=e.find(".retry-notification");L=e.find(".otpForm");w.show();if(!FKART.login.isUserLoggedIn()){a5.show();af.hide()}else{a5.hide();af.show()}aF()}function aF(){e.on("beforeHide",function(a8){n();Q();t()});aW.on("click",function(){aI.hide();a3.show();aH.hide();aG.remove();aL();a1("PNExpired")});O.on("click",function(){ah();aI.hide();a3.show();aH.hide();aG.remove();aL();a1("PNExpired")});am.on("click",function(){w.hide();a6();$status="PNTried";if(G){$status="PNReTried"}a1($status)})}function A(a8){return a8}function an(){m=g.val();K=N.val();$.ajax({url:"/lc/verifyOtp",type:"POST",data:{user_id:ak,otp_key:M,otp:m,title:aT,subtitle:y,phoneNumber:ak,marketingSMS:b,AppOffers:K},dataType:"html",success:function(a8){a8=JSON.parse(a8);if(a8.isOtpVerified=="1"){if(a8.smsStatus){aO()}else{aD()}}else{ad()}},error:function(){ad()}})}function ah(){ak=l.val();$.ajax({url:"/lc/generateOtp",type:"POST",data:{userId:ak},dataType:"html",success:function(a8){a8=JSON.parse(a8);if(a8.error_code=="1004"){C()}else{M=a8.otp_key;av()}},error:function(){ad()}})}function U(){ak=l.val();$.ajax({url:"/lc/getVerifiedPhoneNumber",type:"POST",data:{phoneNumber:ak,title:aT,subtitle:y,phoneNumber:ak,marketingSMS:b,AppOffers:K},dataType:"html",success:function(a8){a8=JSON.parse(a8);if(a8.verifiedPhoneNumber){if(a8.smsStatus){aO();a1("SMSTried");event.preventDefault()}else{aD();a1("SMSFailed");event.preventDefault()}}else{ah();a1("OTPTried");event.preventDefault()}},error:function(){F()}})}function aO(){Q();aU();aG.hide();j.hide();ay.hide();aV.hide();L.hide();ac.html(ak);I.show();f.hide();aa.show();c.hide();k();a1("SMSSent")}function aD(){Q();aU();f.hide();aG.hide();j.hide();ay.hide();aV.hide();aH.hide();ac.html(ak);ap.show();a1("SMSFailed")}function ad(){aU();Q();aG.hide();j.hide();ay.hide();aV.hide();aH.hide();ac.html(ak);f.hide();r.show();a1("OTPFailed")}function F(){Q();aU();aG.hide();j.hide();ay.hide();aV.hide();aH.hide();f.hide();r.hide();D.show();a1("SMSFailed")}function av(){aU();Q();aG.hide();j.hide();ay.show();L.show();aV.hide();ac.html(ak);f.show();p.show();ai.hide();ag();a1("OTPSent")}function C(){u.show();aG.hide();j.hide();ay.hide();L.hide();aV.hide();ac.html(ak);f.hide();p.hide();ai.hide();a1("OTPFailed")}function aL(){l=aV.find(".phoneNumber");g=L.find(".otp-field");ak=FKART.login.userPhoneNumber;l.val(ak);aB=aV.find("input[type=button]");aM=L.find("input[type=button]");aR=B.find("#marketingSMSAppDownload");N=B.find("#AppDownloadInterstitial");j=B.find(".infoDiv");ay=B.find(".otpTitle");aG=B.find(".stitle");I=B.find(".smsSuccessDiv");f=B.find(".otpSuccessDiv");r=B.find(".otpErrorDiv");u=B.find(".otpErrorMsgDiv");D=B.find(".otpSendErrorDiv");ap=B.find(".smsErrorDiv");o=B.find(".retry-sms");ar=B.find(".retry-otp");ac=B.find(".phone_number");B.show();L.hide();ay.hide();w.reposition();T()}function T(){aB.on("click",function(a8){ak=l.val();if(!(/^[789]\d{9}$/.test(ak))){l.addClass("error").val("").attr("placeholder","Invalid Number").focus();return}U();a8.preventDefault()});aM.on("click",function(a8){m=g.val();if(!(/^[0-9]{4,6}$/.test(m))){g.addClass("error").val("").attr("placeholder","Invalid OTP").focus();return}else{an();aG.hide();I.hide();j.hide();ap.hide();f.hide();ay.hide();L.hide();a1("SMSTried");a8.preventDefault()}});o.on("click",function(){Q();aU();aJ.html("45");a4.html("60");aG.hide();I.hide();j.hide();aV.hide();ap.hide();U();a1("SMSReTried")});ar.on("click",function(){aU();Q();ah();aJ.html("45");a4.html("60");ay.show();I.hide();L.show();ap.hide();a1("SMSReTried")})}function n(){clearInterval(al);al=null}function Q(){clearInterval(ae);ae=null}function aU(){clearInterval(aP);aP=null}function t(){clearInterval(W);W=null}function aC(){al=setInterval(function(){var a8=parseInt(q.html());if(a8==0){n();aX.hide();aW.show()}q.html(a8-1)},1000)}function k(){ae=setInterval(function(){var a8=parseInt(aJ.html());if(a8==0){Q();aa.hide();c.show()}aJ.html(a8-1)},1000)}function ag(){aP=setInterval(function(){var a8=parseInt(a4.html());if(a8==0){aU();Q();p.hide();ai.show()}a4.html(a8-1)},1000)}function x(a9,a8){var bc=a9.split("?")[1];var bb=bc.split("&");for(var ba=0;ba<bb.length;ba++){var bd=bb[ba].split("=");if(bd[0]==a8){return bd[1]}}}function aZ(){var a8=FKART.urlParser().get("sid");if(a8!="undefined"){return a8}}function v(){$ele=window.location.href;aY=false;G=false}function az(){d()}az()});register_controller("SocialCollabCtrl",function(S){var u=$(S),p=$(".app-ping",u),I=$(".app-offers-button",u),J=$(".app-offers-container",u),Q=$(".socialCollabDialog-popup-content",u),ac=$(".fk-question-mark",u),G,Y,A,Z,w,N,ag,ai,b,B,j,F,K,k,X,z,M,y,L,l,P,E=false,n="title",ab="subtitle",ah,aa,v,a,O,D,m,d=false;function r(){I.click(function(){if(!d){g("Opened");$(this).addClass("open");ac.text("X");setTimeout(function(){J.slideDown(200);d=true},150)}else{g("Closed");J.slideUp(200,function(){I.removeClass("open");ac.text("?");d=false})}});EventBus.subscribe("showSocialCollabPopup",function(){$ele=window.location.href;U($ele);t()});p.on("click",function(aj){if(!p.hasClass("disabled")){g("Clicked");$ele=$(this).data("url");U($ele);t();aj.preventDefault()}})}function t(){ai=null;ad();f()}function g(ak){var aj={};if(ak=="Clicked"){aj.products=s.products}aj.prop21="OpenInApp_"+ak;FKART.omni.customEvent("App only offers",aj)}function H(){h();if(ah&&ah.length>0){var aj=$("<img>");aj.attr("src",ah);Y.append(aj)}else{Y.remove()}C();g("PNSent")}function T(){h();f();g("PNFailed")}function ad(){ai=new FKART.ui.Dialog({showFooter:false,cssClass:"socialCollabDialog",body:Q.html(),destroyOnHide:true,width:"650px"});b=ai.getContainer();w=b.find(".headerDiv");G=b.find(".smsDiv");F=b.find(".smsForm");N=b.find(".send-sms-fake-link");ag=b.find(".send-sms-link");m=b.find(".timer");B=b.find(".retry-notification");ai.show();e()}function e(){b.on("beforeHide",function(aj){af();h();E=false});ag.click(function(){f();g("PNExpired")});B.click(function(){ai.hide();t();g("PNReTried")})}function W(){l=L.val();if(!(/^[789]\d{9}$/.test(l))){L.addClass("error").val("").attr("placeholder","Invalid Number").focus();return}else{$.ajax({url:"/lc/sendSocialCollabSMS",type:"POST",data:{title:n,subtitle:ab,phoneNumber:l,cmpId:aa,token:v,vid:a,captchaText:z.val(),captchaId:M.attr("id")},dataType:"json",success:function(aj){if(aj.captchaStatus){if(aj.smsStatus){V()}else{x()}}else{q()}},error:function(){x()}})}}function q(){o();z.addClass("error").val("").attr("placeholder","Invalid Captcha").focus()}function V(){k.hide();F.hide();y.html(l);A.show();g("SMSSent")}function x(){k.hide();F.hide();y.html(l);Z.show();g("SMSFailed")}function f(){L=F.find(".phoneNumber");l=FKART.login.userPhoneNumber;L.val(l);K=F.find("input[type=submit]");k=G.find(".infoDiv");A=G.find(".smsSuccessDiv");Z=G.find(".smsErrorDiv");j=G.find(".retry-sms");X=F.find(".captchaDiv");z=F.find(".captchaText");P=F.find(".refreshCaptcha");y=G.find(".phone_number");if(/^\d{10}$/.test(l)){E=true;o()}G.show();ai.reposition();R()}function R(){P.click(function(){o();z.val("").focus()});F.submit(function(aj){W();g("SMSTried");aj.preventDefault()});j.click(function(){k.show();F.show();Z.hide();z.removeClass("error").val("").attr("placeholder","Captcha text").focus();o();g("SMSReTried")});L.focus(function(){g("PhoneNumberFocused");if(!E){E=true;o()}})}function o(){$.ajax({url:"/lc/generateCaptcha",type:"POST",dataType:"json",success:function(aj){if(aj.success){M=X.find("img");M.attr("src","data:image/png;base64,"+aj.captchaBytes);M.attr("id",aj.id);X.show();z.show();M.load(function(){if(this.complete){ai.reposition()}})}else{X.find("img").attr("alt","Captcha failed to load")}},error:function(){X.find("img").attr("alt","Captcha failed to load")}})}function af(){clearInterval(O);O=null}function h(){clearInterval(D);D=null}function C(){O=setInterval(function(){var aj=parseInt(m.html());if(aj==0){af();N.hide();ag.show()}m.html(aj-1)},1000)}function c(ak,aj){var an=ak.split("?")[1];var am=an.split("&");for(var al=0;al<am.length;al++){var ao=am[al].split("=");if(ao[0]==aj){return ao[1]}}}function U(aj){aa=c(aj,"cmpId");v=c(aj,"token");a=c(aj,"vid")}function ae(){r()}ae()});